\documentclass[twocolumn]{article}
\usepackage[utf8]{inputenc}
\usepackage[margin=1.75cm]{geometry}
\usepackage{parskip}
\usepackage{xcolor}
\usepackage{hyperref}
\usepackage[
backend=biber,
style=apa
]{biblatex}
\addbibresource{bibliography.bib}
\usepackage{svg}
\usepackage{amsmath}
\usepackage{amssymb}

% Inversion
\newif\ifinvert
\invertfalse % Set \inverttrue or \invertfalse
\ifinvert % Settings when inverted
\pagecolor[rgb]{0,0,0}
\color[rgb]{1,1,1}
\hypersetup{
    colorlinks=true,
    linkcolor=green,
    citecolor=pink,
    urlcolor=red
}
\else % Settings when normal
\hypersetup{
    colorlinks=true,
    linkcolor=olive,
    citecolor=violet,
    urlcolor=purple
}
\fi

\title{Visualizing Color Space}
\author{Kyle Christopher McDermott}
\date{\today}

\begin{document}

% Title Page
\begin{titlepage}
\maketitle
\thispagestyle{empty} % Removes page number
\end{titlepage}

\twocolumn[{
    \section{Introduction}
    Here are described methods for generating and, in particular, coloring diagrams of color space (chromaticity) and the visible spectrum.  Section \ref{sec:derivation} covers the derivation of the Commission internationale de l'eclairage (CIE) $(x,y)$ chromaticity diagram starting from experimental data collected from human observers, through the derivation of cone (photoreceptor) sensitivities and the color matching functions used to determine chromaticity from light spectra.  Section \ref{sec:color_mixing} uses the chromaticity diagram to illustrate how a few primary colors can be mixed to create a range of colors between, including the sRGB standard which will be used here to determine chromaticity from display color and vice versa.  Section \ref{sec:chromaticity_coloration} presents multiple methods for the coloration of diagrams of chromaticity and of the visible spectrum and the key differences and considerations for selecting among them.  Section \ref{sec:color_temperature} discusses correlated color temperature - relating to black-body radiation and the Planckian locus which is often depicted on chromaticity diagrams.  Finally, Section \ref{sec:color_blindndess} illustrates the theory behind both generating test stimuli for, and filtering images to mimic the effects of, color blindness.\\
    
    By far the resource used most in the preparation of this document is the excellent database maintained by Andrew Stockman and his colleagues in the Colour \& Vision Research Laboratory at the Institute of Ophthalmology, University College London (\url{http://www.cvrl.org/} or \url{http://cvrl.ucl.ac.uk/}).  The theory, key variables, and tabulated data used both as source and a check on my own computations are there thoughtfully laid out, and links to key pages on their website appear throughout Section \ref{sec:derivation}.
    \section{Derivation of CIE $(x,y)$ Chromaticity} \label{sec:derivation}
}]
Typically the color matching functions of CIE 1931 standard (\cite{cie1932commission}) are used to determine the $(x,y)$ chromaticity coordinate from a spectrum of light - doing so for a range of hypothetically purely monochromatic lights results in the “spectrum locus” curve depicted in chromaticity diagrams - and these are based on experiments which presented a relatively small 2$^\circ$ visual angle stimulus to experimental observers (\cite{wright1929re,guild1931colorimetric}).  However, the variables and tabulated data necessary to derive these color matching functions from experimental observations - and to verify my own computations at each step - are more readily available for a larger 10$^\circ$ stimulus (\cite{stiles1959npl}) (which originally contributed to the CIE 1964 standard).  The method detailed here ultimately results in color matching functions for the CIE 170-2 10$^\circ$ Observer standard.  The more typical CIE 1931 2$^\circ$ Observer standard color matching functions will be used in later sections primarily because the sRGB primaries are defined in that space.  As will be illustrated, the 2$^\circ$ and 10$^\circ$ chromaticity diagrams are similar enough to make the distinction important only for narrowly defined circumstances (i.e. experiments probing human vision).
\subsection{Color Matching Experiment}
Stiles \& Burch presented in 1959 data from 49 individual observers (including 4 experimenters who are represented twice for a total of 53 observations across two similar conditions) using a 10$^\circ$ Stimulus (\cite{stiles1959npl}).  They also presented data from 10 observers for a 2$^\circ$ stimulus, but this has been deemed too few from which to build a “standard observer”.  The Color \& Vision Research Laboratory have made the data available here (file download \href{http://www.cvrl.org/database/data/sb_individual/SB10_corrected_indiv_CMFs.xls}{link}); these are “corrected data” (see \href{http://www.cvrl.org/database/text/sb_individual/sb10_individual.htm}{here} (\cite{stiles1958average})).
\subsubsection{Stimuli \& Procedure}
The experiment presented observers with a circular stimulus 10$^\circ$ in diameter, bisected vertically.  On the "test" side were presented a range of narrow-band lights from 14,000 $cm^{-1}$ to 25,500 $cm^{-1}$ (roughly 714 $nm$ to 392 $nm$, note the reversed order as the units are inverses of each other).  On the other, "match" side was a mixture of (up to) three “primary” lights at 15,500 $cm^{-1}$ (roughly 645 $nm$, and reddish), 19,000 $cm^{-1}$ (roughly 526 $nm$, and greenish), and 22,500 $cm^{-1}$ (roughly 444 $nm$, and bluish); the experimental data are “transformed” from the actual, physical values of 15,418 $cm^{-1}$, 18,997 $cm^{-1}$, and 22,456 $cm^{-1}$, respectively.  Observers’ task was to adjust the intensity of the three primary lights on one side to match the single light on the other side.

As will be illustrated later, it is not always possible to mix three primaries in this way to create a match if the test stimulus is outside the range of colors achievable by a mixing of those primaries.  Therefore the experimenters allowed the primaries to be adjusted to “negative” intensities - this meant that instead of adding the primary to the "match" side, it was instead added to the "test" side.  Therefore, when one of the primaries was adjusted to a negative intensity, observers were adjusting the appearance of both sides of the stimulus to match them.
\subsubsection{Data Visualization}
\begin{figure*}[h]
    \ifinvert
        \includesvg[width=\textwidth]{../images/figure_01_color_matching_experiment_data_inverted.svg}
    \else
        \includesvg[width=\textwidth]{../images/figure_01_color_matching_experiment_data.svg}
    \fi
    \caption{Individual (faded) and average (bold) settings of the red, green, and blue primary lights relative to the test light intensity plotted across all test light wave-numbers.  Positive settings indicate primary lights added together on the "match" side of the stimulus.  Negative settings indicate primary lights instead added to the "test" side of the stimulus along with the test light.  Where horizontal and vertical dotted lines cross, no settings were recorded (note there is zero individual variability at these points); instead it was presumed that each primary would exactly match itself in isolation.  Note that the step size between test lights is larger below 16,000 $cm^{-1}$ and above 21,500 $cm^{-1}$. IMAGE LINK, CODE LINK}\label{fig:experiment_raw}
\end{figure*}
Figure \ref{fig:experiment_raw} plots the 53 individual traces of observers' settings as well as the average (in bold).  The original data are given in wave-number ($cm^{-1}$), however we will generally be using wavelength ($nm$) in our formulations and assign the symbol lambda ($\lambda$) to it.  The experimental average settings for the red, green, and blue primaries - as functions of wavelength $\lambda$ - are symbolized by $\bar{R}(\lambda)$, $\bar{G}(\lambda)$, and $\bar{B}(\lambda)$, respectively.

The red, green, and blue primary settings can be reduced to two values to form a chromaticity coordinate in the experimental chromaticity space.  The chromaticity coordinates - as functions of wavelength $\lambda$ - $\bar{r}(\lambda)$ and $\bar{g}(\lambda)$ are given by:
\begin{equation}
    \begin{aligned}
        \bar{r}(\lambda)=\frac{\bar{R}(\lambda)}{\bar{R}(\lambda)+\bar{G}(\lambda)+\bar{B}(\lambda)}\\
        \bar{g}(\lambda)=\frac{\bar{G}(\lambda)}{\bar{R}(\lambda)+\bar{G}(\lambda)+\bar{B}(\lambda)}
    \end{aligned}
\end{equation}
Figure \ref{fig:experiment_chromaticity} plots the settings from Figure \ref{fig:experiment_raw} converted into this experimental chromaticity space.  Note that the individual variability among test wave-numbers between the green and blue primaries are relatively large; bear this in mind when presented with the different chromaticity diagrams of the CIE standards presented later (see Figure \ref{fig:chromaticity_spaces}).
\begin{figure}[h]
    \ifinvert
        \includesvg[width=\linewidth]{../images/figure_02_color_matching_experiment_chromaticity_inverted.svg}
    \else
        \includesvg[width=\linewidth]{../images/figure_02_color_matching_experiment_chromaticity.svg}
    \fi
    \caption{Individual (faded) and average (bold) settings converted to experimental chromaticity.  Note that the settings between 19,000 $cm^{-1}$ (green) and 22,500 $cm^{-1}$ (blue) where the red setting is negative (see Figure \ref{fig:experiment_raw}) extend up and left relatively far, and that the individual variability here is also magnified. IMAGE LINK, CODE LINK}\label{fig:experiment_chromaticity}
\end{figure}
\subsubsection{Links}
\begin{itemize}
    \item Colour \& Vision Research Laboratory
    \begin{itemize}
        \item \href{http://www.cvrl.org/stilesburch10_ind.htm}{Stiles \& Burch individual 10$^\circ$ color matching data}
    \end{itemize}
    \item Figure Images
    \begin{itemize}
        \item FIGURE 1 LIGHT AND DARK SVG
        \item FIGURE 2 LIGHT AND DARK SVG
    \end{itemize}
    \item GitHub Scripts
    \begin{itemize}
        \item DATA INGESTION OF INDIVIDUAL AND MEAN DATA
        \item FIGURE GENERATION FOR FIGURES 1 \& 2
    \end{itemize}
\end{itemize}
\subsection{Conversion to Cone Sensitivities}
In order to get from the color matching experimental data described above to the color matching \textit{functions} that will define the color spaces we wish to visualize we need to go through the "cone fundamentals" which describe the relative sensitivity to different wavelengths of light of the three types of cone photoreceptors.  The experiments used to measure the sensitivities of the different cone types will not be explored in detail, however the articles that describe these experiments present the necessary conversion constants to transform the matching experiment data into the cone fundamentals (and later to transform the cone fundamentals into the color matching functions).
\subsubsection{Conversion Equations}
The cone fundamentals are expressed as linear combinations of the three (average) settings for the red, green, and blue primaries from the color matching experiment:
\begin{equation}
    \begin{aligned}
        L_R\bar{R}(\lambda)+L_G\bar{G}(\lambda)+L_B\bar{B}(\lambda)=\bar{L}(\lambda)\\
        M_R\bar{R}(\lambda)+M_G\bar{G}(\lambda)+M_B\bar{B}(\lambda)=\bar{M}(\lambda)\\
        S_R\bar{R}(\lambda)+S_G\bar{G}(\lambda)+S_B\bar{B}(\lambda)=\bar{S}(\lambda)
    \end{aligned}
\end{equation}
where $\bar{L}(\lambda)$, $\bar{M}(\lambda)$, and $\bar{S}(\lambda)$ are the sensitivities of the long-, medium-, and short-wavelength-sensitive cones, respectively.  The coefficients $L_R$, $L_G$, ..., $S_G$, and $S_B$ are to be determined experimentally.

The above linear combinations can be expressed as a linear transformation:
\begin{equation}
    \begin{bmatrix}
        L_R&L_G&L_B\\
        M_R&M_G&M_B\\
        S_R&S_G&S_B
    \end{bmatrix}\begin{bmatrix}
        \bar{R}(\lambda)\\
        \bar{G}(\lambda)\\
        \bar{B}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        \bar{L}(\lambda)\\
        \bar{M}(\lambda)\\
        \bar{S}(\lambda)
    \end{bmatrix}
\end{equation}
At this stage there are nine coefficients to find, however there are two things that can reduce this number: first, we will assert that we don't need to find the absolute sensitivities of the different cone types - we only wish to get the shape of the functions, but will normalize them to get \textit{relative} sensitivity only - and second, we will assert that the short-wavelength-sensitive cones are completely insensitive to the red primary light used in the color matching experiment.  Arbitrarily choosing the coefficients for the blue primary light, we use them to define three normalization constants $k$ as:
\begin{equation}\label{eq:cone_fundamental_normalization_constants_symbolic}
    \begin{aligned}
        k_L=\frac{1}{L_B}\\
        k_M=\frac{1}{M_B}\\
        k_S=\frac{1}{S_B}
    \end{aligned}
\end{equation}
the values of which will be determined later so as to independently make the maximum of each cone sensitivity equal to $1.0$.  Factoring these into the linear transformation gives:
\begin{equation}\label{eq:cone_fundamental_linear_transformation_symbolic_simplified}
    \begin{bmatrix}
        \frac{L_R}{L_B}&\frac{L_G}{L_B}&1\\
        \frac{M_R}{M_B}&\frac{M_G}{M_B}&1\\
        0&\frac{S_G}{S_B}&1
    \end{bmatrix}\begin{bmatrix}
        \bar{R}(\lambda)\\
        \bar{G}(\lambda)\\
        \bar{B}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        k_L\bar{L}(\lambda)\\
        k_M\bar{M}(\lambda)\\
        k_S\bar{S}(\lambda)
    \end{bmatrix}
\end{equation}
and now there are only five coefficients to find.
\subsubsection{Constants from Experimentation}
By comparing the sensitivity of observers who possess only short-wavelength-sensitive cones (\textit{s}-cone monochromats) to typical trichromats the sensitivity of \textit{s}-cones to various wavelengths of light was determined and the coefficient $\frac{S_G}{S_B}$ was estimated to be $0.010600$ (\cite{stockman1999spectral}).  Color-blind observers with missing \textit{m}- or \textit{l}-cones were compared to trichromats to derive the remaining coefficients: $\frac{L_R}{L_B}=2.846201$, $\frac{L_G}{L_B}=11.092490$, $\frac{M_R}{M_B}=0.168926$, and $\frac{M_G}{M_B}=8.265895$
 (\cite{stockman2000spectral}), filling out the linear transformation:
\begin{equation}\label{eq:cone_fundamental_linear_transformation}
    \begin{bmatrix}
        2.846201&11.092490&1\\
        0.168926&8.265895&1\\
        0&0.010600&1
    \end{bmatrix}\begin{bmatrix}
        \bar{R}(\lambda)\\
        \bar{G}(\lambda)\\
        \bar{B}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        k_L\bar{L}(\lambda)\\
        k_M\bar{M}(\lambda)\\
        k_S\bar{S}(\lambda)
    \end{bmatrix}
\end{equation}
Passing the mean color matching experiment settings through this linear transformation gives us the correct shapes of the cone fundamentals, however their relative scale is still arbitrary (see Figure \ref{fig:unnormalized_cone_fundamentals}).  All three series pass through a value of $1.0$ where the wavelength of light matches the blue experimental primary simply because of the method used to define the constants $k$.
\begin{figure*}[h]
    \ifinvert
        \includesvg[width=\textwidth]{../images/figure_03_unnormalized_cone_fundamentals_inverted.svg}
    \else
        \includesvg[width=\textwidth]{../images/figure_03_unnormalized_cone_fundamentals.svg}
    \fi
    \caption{Unnormalized cone fundamentals transformed from color matching experiment mean settings using equation \ref{eq:cone_fundamental_linear_transformation}.  Dashed vertical lines indicate the wavelengths of the experimental primary lights; note that all three fundamentals pass through $1.0$ at the wavelength corresponding to the experimental blue primary.  IMAGE LINK, CODE LINK}\label{fig:unnormalized_cone_fundamentals}
\end{figure*}
\subsubsection{Normalization}
The Colour \& Vision Research Laboratory does not list their computed normalization constants $k$, but the procedure is straightforward and we can check our work with their tabulated values for the normalized cone sensitivities.  Using quadratic spline interpolation to smooth out the unnormalized cone fundamentals in Figure \ref{fig:unnormalized_cone_fundamentals}, the peak sensitivities for the long-, medium-, and short-wavelength sensitive cones are $k_L\approx14.831370$, $k_M\approx8.797703$, and $k_S\approx1.001009$, respectively (at $569 nm$, $541 nm$, and $445 nm$, respectively) (CODE LINK).  Using equation \ref{eq:cone_fundamental_normalization_constants_symbolic} to solve for $L_B$, $M_B$, and $S_B$ and factoring into the linear transformation in equation \ref{eq:cone_fundamental_linear_transformation_symbolic_simplified} we now have the linear transformation to convert from the color matching experiment mean settings into \textit{normalized} cone fundamentals:
\begin{equation}
    \begin{bmatrix}
        0.191904&0.747907&0.067425\\
        0.019201&0.939552&0.113666\\
        0&0.010589&0.998992
    \end{bmatrix}\begin{bmatrix}
        \bar{R}(\lambda)\\
        \bar{G}(\lambda)\\
        \bar{B}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        \bar{L}(\lambda)\\
        \bar{M}(\lambda)\\
        \bar{S}(\lambda)
    \end{bmatrix}
\end{equation}
Figure \ref{fig:cone_fundamentals} shows the resulting normalized cone fundamentals smoothed by interpolation.
\begin{figure*}[h]
    \ifinvert
        \includesvg[width=\textwidth]{../images/figure_04_cone_fundamentals_inverted.svg}
    \else
        \includesvg[width=\textwidth]{../images/figure_04_cone_fundamentals.svg}
    \fi
    \caption{Normalized, smoothed cone fundamentals.  The approximate peak of each cone's sensitivity curve is annotated.  IMAGE LINK, CODE LINK}\label{fig:cone_fundamentals}
\end{figure*}
\subsubsection{Links}
\begin{itemize}
    \item Article Full Text
    \begin{itemize}
        \item \cite{stockman1999spectral} - \href{https://www.sciencedirect.com/science/article/pii/S0042698998002259}{article page}
        \item \cite{stockman2000spectral} - \href{https://www.sciencedirect.com/science/article/pii/S0042698900000213}{article page}
    \end{itemize}
    \item Colour \& Vision Research Laboratory
    \begin{itemize}
        \item \href{http://www.cvrl.org/cones.htm}{Cone Fundamentals Data Sets}
        \item \href{http://www.cvrl.org/database/text/cones/ss10.htm}{10$^\circ$ Cone Fundamentals Information}
    \end{itemize}
    \item Figure Images
    \begin{itemize}
        \item FIGURE 3 LIGHT AND DARK SVG
        \item FIGURE 4 LIGHT AND DARK SVG
    \end{itemize}
    \item GitHub Scripts
    \begin{itemize}
        \item DATA INGESTION OF CONE FUNDAMENTALS
        \item ESTIMATION OF NORMALIZATION CONSTANTS
        \item FIGURE GENERATION FOR FIGURES 3 \& 4
    \end{itemize}
\end{itemize}
\subsection{Color Matching Functions}
The CIE color matching functions, and the resulting chromaticity diagram, do not directly represent the results of a color matching \textit{experiment}.  The chromaticity coordinates $x$ and $y$ do not represent primary lights of any physically realizable spectrum.  Whereas chromaticities along the vertical ($r=0$) and horizontal ($g=0$) axes in the $(r,g)$ chromaticity diagram depicted in Figure \ref{fig:experiment_chromaticity} represent actual colors within the bounds of those that can be achieved by mixing the primaries together, the vertical and horizontal axes of the $(x,y)$ chromaticity diagram are outside of the spectrum locus and the realm of possible physical colors.  Part of the reasoning behind the construction of the $(x,y)$ chromaticity diagram is, in fact, to have all possible physical colors fall within the bounding triangle of $0$ to $1$ on the two axes and the line $x+y=1$.

The color matching functions can each be expressed as a linear combination of the three cone fundamentals:
\begin{equation}
    \begin{aligned}
        X_L\bar{L}(\lambda)+X_M\bar{M}(\lambda)+X_S\bar{S}(\lambda)=\bar{X}(\lambda)\\
        Y_L\bar{L}(\lambda)+Y_M\bar{M}(\lambda)+Y_S\bar{S}(\lambda)=\bar{Y}(\lambda)\\
        Z_L\bar{L}(\lambda)+Z_M\bar{M}(\lambda)+Z_S\bar{S}(\lambda)=\bar{Z}(\lambda)
    \end{aligned}
\end{equation}
where $\bar{X}(\lambda)$, $\bar{Y}(\lambda)$, and $\bar{Z}(\lambda)$ are the color matching functions.  The letters don't correspond to color or cone type, and are thus arbitrarily chosen.  The coefficients $X_L$, $X_M$, ..., $Z_M$, and $Z_S$ need to be determined.  As before, we will express the above set linear of combinations as a linear transformation:
\begin{equation}
    \begin{bmatrix}
        X_L&X_M&X_S\\
        Y_L&Y_M&Y_S\\
        Z_L&Z_M&Z_S
    \end{bmatrix}\begin{bmatrix}
        \bar{L}(\lambda)\\
        \bar{M}(\lambda)\\
        \bar{S}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        \bar{X}(\lambda)\\
        \bar{Y}(\lambda)\\
        \bar{Z}(\lambda)
    \end{bmatrix}
\end{equation}
\subsubsection{Luminous Efficiency}
The second color matching function $\bar{Y}(\lambda)$ is constructed to represent luminance, or perceived brightness.  The perceived brightness of lights of different wavelengths is expressed by a luminous efficiency function which depends, among other things, on the state of adaptation of the visual system being measured experimentally.  The perception of brightness is driven by the long- and medium-wavelength-sensitive cones, so the coefficient $Y_S=0$ and the short-wavelength-sensitive cone activation will not impact $\bar{Y}(\lambda)$.  The ratio of long- to medium-wavelength -sensitive cone contribution to luminous efficiency under normal daylight adaptation conditions was determined experimentally to be $\approx1.981377$ (\cite{sharpe2011luminous}):
\begin{equation}
    1.981377\bar{L}(\lambda)+\bar{M}(\lambda)=V^*_{D65}(\lambda)
\end{equation}
where $V^*_{D65}$ is luminous efficiency when the visual system is adapted to standard illuminant $D65$ (normal daylight with a correlated color temperature of approximately $6,500K$).  The color matching function $\bar{Y}(\lambda)$ is further constrained to peak at $1.0$ and so, while maintaining the above ratio, its linear combination is:
\begin{equation}
    0.692839\bar{L}(\lambda)+0.349676\bar{M}(\lambda)=\bar{Y}(\lambda)
\end{equation}
\subsubsection{Remaining Functions}
The third color matching function $\bar{Z}(\lambda)$ depends only on the activation of the short-wavelength-sensitive cone, so $Z_L=0$ and $Z_M=0$.  All three color matching functions have the same integral (area under the curve) and so the linear combination for the third function is:
\begin{equation}
    2.146879\bar{S}(\lambda)=\bar{Z}(\lambda)
\end{equation}
so that its area matches that under $\bar{Y}(\lambda)$.

Of the three color matching functions $\bar{X}(\lambda)$ bears the least resemblance to any physiological feature of the visual system - in fact, it has two peaks.  This function is constructed to give the resulting chromaticity diagram some of its features, visualized later, but in short the realm of physical colors is contained within the triangular area described earlier and to fill that area reasonably efficiently.  The following linear combination, having all positive values and the same area as the other two functions, was chosen to minimize the error between the present derivations and the CIE 1964 standard (also based on the same color matching experiment data) with acknowledgement given to Jan Henrik Wold (no citation given):
\begin{equation}
    1.939864\bar{L}(\lambda)-1.346644\bar{M}(\lambda)+0.430449\bar{S}(\lambda)=\bar{X}(\lambda)
\end{equation}
The resulting linear transformation is:
\begin{equation}
    \begin{bmatrix}
        1.939864&-1.346644&0.430449\\
        0.692839&0.349676&0\\
        0&0&2.146879
    \end{bmatrix}\begin{bmatrix}
        \bar{L}(\lambda)\\
        \bar{M}(\lambda)\\
        \bar{S}(\lambda)
    \end{bmatrix}=\begin{bmatrix}
        \bar{X}(\lambda)\\
        \bar{Y}(\lambda)\\
        \bar{Z}(\lambda)
    \end{bmatrix}
\end{equation}
Transforming the cone fundamentals from Figure \ref{fig:cone_fundamentals} gives the color matching functions in Figure \ref{fig:color_matching_functions}.  These are referred to in various places as: CIE XYZ functions transformed from the CIE 2006 LMS functions, CIE 2012 XYZ color matching functions, and/or the CIE 170-2 10$^\circ$ standard; in this document we'll use the last designation.
\begin{figure}[h]
    \ifinvert
        \includesvg[width=\linewidth]{../images/figure_05_color_matching_functions_inverted.svg}
    \else
        \includesvg[width=\linewidth]{../images/figure_05_color_matching_functions.svg}
    \fi
    \caption{CIE 170-2 10$^\circ$ color matching functions transformed from the 10$^\circ$ cone fundamentals.  Note that $\bar{Y}(\lambda)$ peaks at $1.0$ and the integrated area under all three functions are equal to each other. IMAGE LINK, CODE LINK}\label{fig:color_matching_functions}
\end{figure}
\subsubsection{Using the Functions}
The color matching functions are used to determine the tristimulus values $(X,Y,Z)$ for a given spectrum of light.  The three-value coordinate is typically reduced to a two-value coordinate of chromaticity $(x,y)$ - essentially another normalization - with the third coordinate lower-case $z$ ignored as it doesn't provide any additional information.  This will free up a third dimension to be used for luminance later on.

Figure \ref{fig:d65_spectrum} shows the spectrum for the CIE standard illuminant $D65$ for average midday illumination (clear skies in Western / Northern Europe) (\cite{judd1964spectral}).  Such spectra will here be represented by $\bar{R}(\lambda)$ generally, and for this specific spectrum $\bar{R}_{D65}(\lambda)$.
\begin{figure}[h]
    \ifinvert
        \includesvg[width=\linewidth]{../images/figure_06_d65_spectrum_inverted.svg}
    \else
        \includesvg[width=\linewidth]{../images/figure_06_d65_spectrum.svg}
    \fi
    \caption{CIE standard illuminant $D65$ energy spectrum.  IMAGE LINK, CODE LINK}\label{fig:d65_spectrum}
\end{figure}
The tristimulus values are found by multiplying each color matching function by the spectrum of interest and integrating to find the area under the resulting curves:
\begin{equation}\label{eq:tristimulus_from_spectrum}
    \begin{aligned}
        X=\int\bar{R}(\lambda)\bar{X}(\lambda)d\lambda\\
        Y=\int\bar{R}(\lambda)\bar{Y}(\lambda)d\lambda\\
        Z=\int\bar{R}(\lambda)\bar{Z}(\lambda)d\lambda
    \end{aligned}
\end{equation}
To convert to chromaticity coordinates:
\begin{equation}\label{eq:chromaticity_from_tristimulus}
    \begin{aligned}
        x=\frac{X}{X+Y+Z}\\
        y=\frac{Y}{X+Y+Z}\\
        z=\frac{Z}{X+Y+Z}\\
        \therefore x+y+z=1
    \end{aligned}
\end{equation}
Given the shared denominator for all three coordinates, any one can be found given the other two, so $z$ is typically left out of the discussion.  Figure \ref{fig:estimating_d65_chromaticity} illustrates the process of determining chromaticity from the $D65$ spectrum.
\begin{figure*}[h]
    \ifinvert
        \includesvg[width=\textwidth]{../images/figure_07_estimating_d65_chromaticity_inverted.svg}
    \else
        \includesvg[width=\textwidth]{../images/figure_07_estimating_d65_chromaticity.svg}
    \fi
    \caption{Illustration of the estimation of chromaticity from a spectrum.  The three left panels show the products of the three color matching functions with the $D65$ spectrum.  The area shaded under each resulting curve is annotated within each panel by applying equation \ref{eq:tristimulus_from_spectrum}.  The right panel shows the resulting chromaticity coordinate $(x,y)$ for the CIE 170-2 10$^\circ$ space (slightly different from the typically used CIE 1931).  IMAGE LINK, CODE LINK}\label{fig:estimating_d65_chromaticity}
\end{figure*}
\subsubsection{Spectrum Locus}
Chromaticity diagrams typically depict the “spectrum locus” which is the inverted “U” shape that represents the boundary within which all physically real colors - the chromaticities resulting from all possible spectra - lie.  This is based on the notion that the most extreme chromaticities arise from the narrowest possible single-wavelength spectra (i.e. pure, monochromatic lights) and all other possible spectra must be some mix of wavelengths and therefore fall within the line of monochromatic spectra - the spectrum locus.  The chromaticity coordinates of the spectrum locus are given by:
\begin{equation}
    \begin{aligned}
        \bar{x}(\lambda)=\frac{\bar{X}(\lambda)}{\bar{X}(\lambda)+\bar{Y}(\lambda)+\bar{Z}(\lambda)}\\
        \bar{y}(\lambda)=\frac{\bar{Y}(\lambda)}{\bar{X}(\lambda)+\bar{Y}(\lambda)+\bar{Z}(\lambda)}
    \end{aligned}
\end{equation}
using the color matching functions themselves ($\bar{X}(\lambda)$, $\bar{Y}(\lambda)$, and $\bar{Z}(\lambda)$).  The curved path with ends joined at the bottom by a dotted line depicted in Figure \ref{fig:estimating_d65_chromaticity} is the spectrum locus curve derived from the color matching functions (in Figure \ref{fig:color_matching_functions}) of the CIE 170-2 10$^\circ$ standard.\\

The differences among the CIE standards are slight, owing to updates and corrections over time arising from new experimental data or refinements of the underlying theory.  The difference between 10$^\circ$ and 2$^\circ$ standards arises from the difference in stimulus size, but this difference is usually only important under specific circumstances likely only to arise in psychophysical experiments themselves.  Figure \ref{fig:chromaticity_spaces} shows the spectrum loci and the chromaticity of $D65$ for a selection of CIE standards.  The CIE 170-2 standard (arguably the "modern" standard) has color matching functions for both 2$^\circ$ and 10$^\circ$ stimuli.  The CIE 1964 standard, based on a 10$^\circ$ stimulus, will come up later in the discussion of correlated color temperature (with a further conversion into a different chromaticity coordinate system).  The CIE 1931 standard - the original standard - using a 2$^\circ$ stimulus is still the most commonly cited standard and the one in which the sRGB system is defined.
\begin{figure}[h]
    \ifinvert
        \includesvg[width=\linewidth]{../images/figure_08_chromaticity_spaces_inverted.svg}
    \else
        \includesvg[width=\linewidth]{../images/figure_08_chromaticity_spaces.svg}
    \fi
    \caption{Spectrum loci and $D65$ chromaticities for the CIE 170-2 10$^\circ$ and 2$^\circ$, 1964 10$^\circ$, and 1931 2$^\circ$ standards.  The chromaticity coordinates for $D65$ are given in the legend.  IMAGE LINK, CODE LINK}\label{fig:chromaticity_spaces}
\end{figure}
\subsubsection{Links}
\begin{itemize}
    \item Article Full Text
    \begin{itemize}
        \item \cite{sharpe2011luminous} - \href{http://www.cvrl.org/people/Stockman/pubs/2011\%20Vstar\%20correction\%20SSJJ.pdf}{article page}
    \end{itemize}
    \item Colour \& Vision Research Laboratory
    \begin{itemize}
        \item \href{http://www.cvrl.org/ciexyzpr.htm}{Color Matching Functions (from CIE 2006 LMS)}
        \item \href{http://www.cvrl.org/database/text/cienewxyz/cie2012xyz10.htm}{10$^\circ$ Color Matching Functions Information}
        \item \href{http://www.cvrl.org/cie.htm}{CIE 1931 \& CIE 1964 Color Matching Functions}
    \end{itemize}
    \item Figure Images
    \begin{itemize}
        \item FIGURE 4 LIGHT AND DARK SVG
        \item FIGURE 5 LIGHT AND DARK SVG
        \item FIGURE 6 LIGHT AND DARK SVG
        \item FIGURE 7 LIGHT AND DARK SVG
        \item FIGURE 8 LIGHT AND DARK SVG
    \end{itemize}
    \item GitHub Scripts
    \begin{itemize}
        \item DATA INGESTION OF COLOR MATCHING FUNCTIONS AND CONVERSION TO SPECTRUM LOCI
        \item FIGURE GENERATION FOR ALL FIGURES (4-8)
    \end{itemize}
\end{itemize}
\twocolumn[{\section{Color Mixing} \label{sec:color_mixing}}]
To determine the chromaticity of a mix of two or more light sources we simply add up their tristimulus values ($X$, $Y$, and $Z$) and then apply equation \ref{eq:chromaticity_from_tristimulus}.  This is demonstrated below first with the color matching experiment mean settings used to match the experiment primaries on the match side with the test light (and sometimes an experimental primary) on the test side.  Next are two demonstrations using the tristimulus values of color displays.
\subsection{Color Mixing in the Matching Experiment}
The matching of mixed lights in the color matching experiment is easiest to arrange in a chromaticity diagram for the range of test colors between the green and blue primaries - where the green and blue settings are well above zero and contributing to the match side, and the red setting is well below zero and contributing to the test side - but the math is the same for any test light used in the experiment.  For this demonstration the test light with a wave-number of $20,250cm^{-1}$ is used, where the observers' averaged red, green, and blue settings are $\bar{R}(20,250cm^{-1})=-0.444$, $\bar{G}(20,250cm^{-1})=0.531$, and $\bar{B}(20,250cm^{-1})=0.144$, respectively.  The green and blue settings are positive and their tristimulus values are added together for the match side; the red setting is negative and its tristimulus values will be added to the test light's tristimulus values on the test side:
\begin{equation}\label{eq:match_tristimulus}
    \begin{aligned}
        \bar{G}(20,250cm^{-1})X_G+\bar{B}(20,250cm^{-1})X_B=X_{match}\\
        \bar{G}(20,250cm^{-1})Y_G+\bar{B}(20,250cm^{-1})Y_B=Y_{match}\\
        \bar{G}(20,250cm^{-1})Z_G+\bar{B}(20,250cm^{-1})Z_B=Z_{match}
    \end{aligned}
\end{equation}
\begin{equation}\label{eq:test_tristimulus}
    \begin{aligned}
        X_{20,250cm^{-1}}-\bar{R}(20,250cm^{-1})X_R=X_{test}\\
        Y_{20,250cm^{-1}}-\bar{R}(20,250cm^{-1})Y_R=Y_{test}\\
        Z_{20,250cm^{-1}}-\bar{R}(20,250cm^{-1})Z_R=Z_{test}
    \end{aligned}
\end{equation}
where $X_R$, $Y_R$, and $Z_R$ are the tristimulus values for the red primary, $X_G$, $Y_G$, and $Z_G$ are the tristimulus values for the green primary, $X_B$, $Y_B$, and $Z_B$ are the tristimulus values for the blue primary, and $X_{20,250cm^{-1}}$, $Y_{20,250cm^{-1}}$, and $Z_{20,250cm^{-1}}$ are the tristimulus values for the test light.  To get the tristimulus values for the three primaries and the test light we simply go to those wave-numbers/wavelengths on each of the color matching functions; we are treating these as ideal, monochromatic light sources and so we can forego the multiplication and integration steps implied by equation \ref{eq:tristimulus_from_spectrum} and just use the values of $\bar{X}(\lambda)$, $\bar{Y}(\lambda)$, and $\bar{Z}(\lambda)$.  Figure \ref{fig:color_matching_experiment_tristimulus} annotates the tristimulus values for the primary lights and the selected test light.
\begin{figure*}[h]
    \ifinvert
        \includesvg[width=\textwidth]{../images/figure_09_color_matching_experiment_tristimulus_inverted.svg}
    \else
        \includesvg[width=\textwidth]{../images/figure_09_color_matching_experiment_tristimulus.svg}
    \fi
    \caption{CIE 170-2 10$^\circ$ color matching functions with the tristimulus values of the experiment primaries and the $20,250cm^{-1}$ test light annotated along the curves.  IMAGE LINK, CODE LINK}\label{fig:color_matching_experiment_tristimulus}
\end{figure*}
Factoring the tristimulus values into equations \ref{eq:match_tristimulus} and \ref{eq:test_tristimulus} we can solve for both sides of the experimental stimulus:
\begin{equation}
    \begin{aligned}
        (0.531)0.192+(0.144)0.405=X_{match}=0.160\\
        (0.531)0.850+(0.144)0.087=Y_{match}=0.464\\
        (0.531)0.022+(0.144)2.130=Z_{match}=0.318
    \end{aligned}
\end{equation}
\begin{equation}
    \begin{aligned}
        0.005-(-0.444)0.347=X_{test}=0.159\\
        0.400-(-0.444)0.140=Y_{test}=0.462\\
        0.313-(-0.444)0.000=Z_{test}=0.310
    \end{aligned}
\end{equation}
The tristimulus values on the match and test sides line up reasonably well, though not perfectly due to rounding at various steps (including the tabulated color matching functions).  Using the tristimulus values for the primaries and the selected test light we can get their chromaticities using equation \ref{eq:chromaticity_from_tristimulus}: Red = $(0.713,0.287)$, Green = $(0.180,0.799)$, Blue = $(0.154,0.033)$ and for the $20,250cm^{-1}$ test light we get $(0.007,0.559)$.  The match and test chromaticities come to $(0.170,0.492)$ and $(0.171,0.496)$, respectively - again, reasonably similar.  Plotting all of these on a chromaticity diagram (see Figure X) demonstrates that the mixing of two lights results in a chromaticity falling along a straight line between them, and in the case of the color matching experiment the resulting stimulus chromaticity is the point where the lines connecting the two lights contributing to either side of the stimulus intersect with one another.
\begin{figure}[h]
    \ifinvert
        \includesvg[width=\linewidth]{../images/figure_10_color_matching_experiment_mixing_inverted.svg}
    \else
        \includesvg[width=\linewidth]{../images/figure_10_color_matching_experiment_mixing.svg}
    \fi
    \caption{Chromaticities of the experimental primaries and the $20,250cm^{-1}$ test light.  The green and blue primaries on the match side of the stimulus, and the test light and red primary on the test side of the stimulus, are mixed in proportions to find the chromaticity where the lines joining each pair intersect.  IMAGE LINK, CODE LINK}\label{fig:color_matching_experiment_mixing}
\end{figure}
\subsection{Three-Primary Systems for Color Displays}
\twocolumn[{\section{Chromaticity Diagram Coloration} \label{sec:chromaticity_coloration}}]

\twocolumn[{\section{Color Temperature} \label{sec:color_temperature}}]

\twocolumn[{\section{Color-Blindness} \label{sec:color_blindndess}}]
\twocolumn[{\printbibliography}]

\end{document}